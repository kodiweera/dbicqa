<!DOCTYPE html>
<html>
<head>
    <title id="title">Interactive QA</title>
<!--    <script src="http://code.jquery.com/jquery-latest.min.js" type="text/javascript"></script> -->
    <script src="js/jquery-1.7.1.js" type="text/javascript"></script>

    <script src="js/highcharts.js" type="text/javascript"></script>

    <!--[if lt IE 9]><script src="js/excanvas.js"></script><![endif]-->
    
    <link rel="stylesheet" type="text/css" href="js/biac_qa.css"/>

    <script src="js/jquery.mousewheel.js" type="text/javascript" ></script>
    <script src="js/biac_qa.js" type="text/javascript" ></script>

    <!--[if IE]>
   <style type="text/css">

   td.mild {
       background:transparent;
       filter:progid:DXImageTransform.Microsoft.gradient(startColorstr=#50F5FF2D,endColorstr=#50F5FF2D);
       zoom: 1;
    } 

   td.medium {
       background:transparent;
       filter:progid:DXImageTransform.Microsoft.gradient(startColorstr=#50FFB144,endColorstr=#50FFB144);
       zoom: 1;
    } 

    td.hot {
       background:transparent;
       filter:progid:DXImageTransform.Microsoft.gradient(startColorstr=#50FF0000,endColorstr=#50FF0000);
       zoom: 1;
    } 

    </style>
    <![endif]-->

</head>
<body>

<h1 id="reportlabel"></h1>
<h2 id="reportsublabel">Interactive QA report</h2>

<div id="navigation">
    <ul class="top-level">
        <li id="summary_home">summary</li>
        <li id="qaItems_home">individual stats
            <ul id="indiv_stats" class="sub-level">
            </ul>
        </li>
        
        <li id="slicevar_home">per-slice variation
            <ul id="slicevar_runs" class="sub-level">
            </ul>
        </li>
        <li id="means_home">mean, stddev, sfnr
            <ul id="means_runs" class="sub-level">
            </ul>
        </li>
    </ul>
</div>


<input type="checkbox" checked="checked" value="summary"><label>summary:</label></input>
<!-- container for summary box -->
<ul class="summary"></ul>

<hr>

<input type="checkbox" checked="checked" value="qaindv"><label>individual qa stats:</label></input>
<!--<div class="button" id="testButton">click me</div><div class="button" id="Redraw">click me</div>-->
<!-- container for qa stats -->
<ul id ="qaItems" class="qaItems"></ul>

<hr>

<input type="checkbox" checked="checked" value="slicevar"><label>per-slice variation:</label></input><div class="help">?</div>
<div class="description">
  <p><b>Per-slice variation:</b> this image shows, for each slice at each time point in the data, a measure of "spikiness" at slice granularity that is insensitive to artifacts that affect all slices (e.g. head motion).  Higher numbers indicate a "spike".  It is computed as follows:</p>
<ol>
 <li>For each voxel remove the mean and detrend across time.</li>
 <li>Calculate the absolute value of the z-score across time for each voxel.</li>
 <li>For each slice at each time point, compute the average of this absolute z-score over all voxels in the single slice, producing a Z*T matrix <i>AAZ</i>.</li>
 <li>For each slice at each time point, calculate the absolute value of the "jackknife" z-score of <i>AAZ</i> across all slices at that time point, producing a new Z*T matrix <i>JKZ</i>, which is the per-slice variation.  (To compute a "jackknife" z-score, use all slices <i>except the current slice</i> to calculate mean and standard deviation.  The jackknife has the effect of amplifying outlier slices.)</li>
</ol>
<p><font size=-1>Douglas N. Greve, Nathan S. White, Syam Gadde, FIRST-BIRN. "Automatic Spike Detection for fMRI." Poster. Organization for Human Brain Mapping Annual Meeting, Florence IT 2006.</font></p><div class="close" >close</div>
</div>

<!-- container for slicevariation images -->
<ul class="slicevar"></ul>
<hr>
<input type="checkbox" checked="checked" value="means"><label>mean, standard deviation, sfnr:</label></input><div class="help">?</div>
<div class="description">
    <ul style="margin-left:-25px;">
        <li><p><b>Mean:</b> this is the volume composed of the mean of each voxel across time.</p></li>
        <li><p><b>Standard deviation:</b>this is the volume composed of the standard deviation of each voxel across time. The colorbar goes from 0 to 0.3 * the maximum intensity range of the mean volume.</p></li>
        <li><p><b>Signal-to-Fluctuation Noise Ratio (SFNR):</b>this is a signal-to-noise (SNR) measure calculated for each brain voxel in the middle slice.  It is essentially the average across time divided by standard deviation (of detrended signal) across time.</p>
<p><font size=-1>Friedman L, Glover GH, The FBIRN Consortium.  "Reducing interscanner variability of activation in a multicenter fMRI study: Controlling for signal-to-fluctuation-noise-ratio (SFNR) differences."  Neuroimage. September 2, 2006.</font></p></li>
        <li><p><b>Mask:</b> this mask is generated by creating a histogram of voxel intensities, fitting a curve to the histogram, and choosing the first local minimum of the curve as a threshhold.  The assumption of this algorithm is that the data will exhibit two "humps" in the histogram, the first being noise, and the second being actual brain signal.</p></li>
    </ul>
<div class="close">close</div>
</div>
<!-- container for mean/sfnr/stddev images -->
<ul class="means"></ul>

<hr>
<div class="Scale" id="mean">scale means</div>
<div class="Scale" id="sfnr">scale sfnr</div>
<div class="Scale" id="stddev">scale stddev</div>

<div id="errors"></div>
<div id="localshortnames" style="display:none;"></div>

<script language="javascript" type="application/javascript">
/**
 * Function : dump()
 * Arguments: The data - array,hash(associative array),object
 *    The level - OPTIONAL
 * Returns  : The textual representation of the array.
 * This function was inspired by the print_r function of PHP.
 * This will accept some data as the argument and return a
 * text that will be a more readable version of the
 * array/hash/object that is given.
 * Docs: http://www.openjs.com/scripts/others/dump_function_php_print_r.php
 */
function dump(arr,level) {
	var dumped_text = "";
	if(!level) level = 0;
	
	//The padding given at the beginning of the line.
	var level_padding = "";
	for(var j=0;j<level+1;j++) level_padding += "    ";
	
	if(typeof(arr) == 'object') { //Array/Hashes/Objects 
		for(var item in arr) {
			var value = arr[item];
			
			if(typeof(value) == 'object') { //If it is an array,
				dumped_text += level_padding + "'" + item + "' ...\n";
				dumped_text += dump(value,level+1);
			} else {
				dumped_text += level_padding + "'" + item + "' => \"" + value + "\"\n";
			}
		}
	} else { //Stings/Chars/Numbers etc.
		dumped_text = "===>"+arr+"<===("+typeof(arr)+")";
	}
	return dumped_text;
}


        /* prototype for object size */
        Object.size = function(obj) {
            var size = 0, key;
            for (key in obj) {
                if (obj.hasOwnProperty(key)) size++;
            }
            return size;
        };

</script>

<p>BXH/XCEDE utilities (1.11.14)</p>

<p style="font-size: smaller;">Graphs courtesy of <a href="http://www.highcharts.com/">Highcharts</a>, used under the <a href="http://www.highcharts.com/license">Non-commercial license</a></p>

</body>
</html>
