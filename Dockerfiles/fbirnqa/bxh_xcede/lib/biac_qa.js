$(document).ready(function(){function V(a,b,c){for(var k=[],y=0;y<b.length;y++){var t=b[y],g="json/qa_arraystats_"+a+"_"+c[t]+".json";$.ajax({type:"GET",url:w+g,beforeSend:function(a){a.overrideMimeType&&a.overrideMimeType("application/json")},async:!1,dataType:"json",success:function(b){k[t]=[];statsdata=b.data;for(var c=0,c=0;c<statsdata.length;c++)statsdata[c][0]=parseFloat(statsdata[c][0]),statsdata[c][1]=parseFloat(statsdata[c][1]);summary=b.summary;summary.count=parseFloat(summary.count);summary.mean=
parseFloat(summary.mean);summary.stddev=parseFloat(summary.stddev);k[t][a]=b},error:function(a,b,c){$("#errors").append("failed loading: "+w+g+b.toString()+c.toString())}})}return k}function aa(a){var b={sum:0,mean:0,count:0,variance:0,stddev:0};b.count=a.length;for(var c=b.sum=0;c<a.length;c++)b.sum+=a[c][1];b.mean=b.sum/b.count;for(var c=a.length,k=0;c--;)k+=Math.pow(a[c][1]-b.mean,2);b.variance=k/b.count;b.stddev=Math.sqrt(b.variance);return b}function W(a,b,c,k,y){k[0]>=k[1]&&alert("function get_hist: plotrange[0] (min) >= plotrange[1] (max)!");
for(var t=0,g=0,m=y?b+k[0]*c:k[0],f=y?b+k[1]*c:k[1],k=[],d=0;m<b-d*c;d++)g++,k.push(0);for(d=0;b+d*c<f;d++)t++,k.push(0);m=g+t;for(f=0;f<a.length;f++)d=(a[f][1]-b)/c,t=0,t=0>d?(d|0)+g-1:(d|0)+g,0>t&&(t=0),t>=m&&(t=m-1),k[t]+=1;a=[];for(t=0;t<m&&0==k[t];t++);for(d=m-1;0<=d&&0==k[d];d--);for(;t<=d;t++)m=t-g+0.5,y||(m*=c,m+=b),a.push([m,k[t]]);return a}function X(a,b,c,k){var d=a+"_LI",g=document.createElement("li");g.id=d;var d=document.createElement("li"),l=document.createElement("input");l.setAttribute("type",
"checkbox");l.setAttribute("checked","checked");l.setAttribute("value",a);var m=document.createElement("div");m.setAttribute("class","help");var f=document.createTextNode("?");m.appendChild(f);var n=document.createElement("label"),f=document.createTextNode(a+":");n.appendChild(f);var r=document.createElement("div");r.setAttribute("class","description");var o=document.createElement("div");o.setAttribute("class","close");f=document.createTextNode("close");o.appendChild(f);r.appendChild(o);d.appendChild(l);
d.appendChild(n);d.appendChild(m);d.appendChild(r);l=document.getElementById("qaItems");l.appendChild(d);l.appendChild(g);Y(a,b,c,k)}function Y(a,b,c,k){function d(a,b){var c=document.createElement("div");c.id=b;c.setAttribute("style","border: thin dotted #DDD; font-style: italic; font-size: small; color: #088; width: 100%; position: absolute; top: 0px; text-align: center; z-index: 1;");a.appendChild(c);var e=document.createElement("div"),k=document.createElement("div"),p=document.createElement("div");
e.setAttribute("class","zh");p.setAttribute("class","zv");k.setAttribute("class","zc");c.appendChild(e);c.appendChild(p);c.appendChild(k);k.id=b+"_text";var j=document.createElement("div"),f=document.createElement("div"),i=document.createElement("div"),h=document.createElement("div");j.setAttribute("class","abox-l");i.setAttribute("class","abox-r");f.setAttribute("class","abox-l");h.setAttribute("class","abox-r");j.id=b+"_hin";f.id=b+"_vin";i.id=b+"_hout";h.id=b+"_vout";e.appendChild(j);e.appendChild(i);
p.appendChild(f);p.appendChild(h);i.appendChild(document.createElement("div")).setAttribute("class","arr-rl");i.appendChild(document.createElement("div")).setAttribute("class","arr-lr");j.appendChild(document.createElement("div")).setAttribute("class","arr-ll");j.appendChild(document.createElement("div")).setAttribute("class","arr-rr");h.appendChild(document.createElement("div")).setAttribute("class","arr-dt");h.appendChild(document.createElement("div")).setAttribute("class","arr-ub");f.appendChild(document.createElement("div")).setAttribute("class",
"arr-ut");f.appendChild(document.createElement("div")).setAttribute("class","arr-db");return{div:$("#"+c.id),text:$("#"+k.id),hin:$("#"+j.id),hout:$("#"+i.id),vin:$("#"+f.id),vout:$("#"+h.id)}}function g(a,b,c,e,k){for(var a=a.container,p=null,a=p="undefined"!==typeof a.clip?a.clip.height:a.style.pixelHeight?a.style.pixelHeight:a.offsetHeight,p=b.getExtremes(),a=Math.ceil(15/(k/(p.max-p.min)*a)),p=Math.floor(5/a)*a,j=-1*p;j<=p;j+=a)b.addPlotLine({id:c+"z"+j.toString(),color:"red",width:1,dashStyle:"Dot",
label:{text:"z = "+j.toString(),x:-1,align:"right",y:4,textAlign:"left"},value:[e+j*k]})}function l(a,b,c,e,p){function k(){if(j.hindown)P(j,1+j.zoomFactor,1);else if(j.houtdown)P(j,1-j.zoomFactor,1);else if(j.vindown)P(j,1,1+j.zoomFactor);else if(j.voutdown)P(j,1,1-j.zoomFactor);else return;setTimeout(k,50)}var j={chart:b,zoomFactor:0.1,lastX:null,lastY:null,mouseDown:null,zoomOn:!1,zoomstruct:p,hindown:!1,houtdown:!1,vindown:!1,voutdown:!1};j.zoomstruct&&(j.zoomstruct.hin.mouseup(function(){j.hindown=
!1;j.zoomstruct.hin.css("border-style","outset");return!1}),j.zoomstruct.hout.mouseup(function(){j.houtdown=!1;j.zoomstruct.hout.css("border-style","outset");return!1}),j.zoomstruct.vin.mouseup(function(){j.vindown=!1;j.zoomstruct.vin.css("border-style","outset");return!1}),j.zoomstruct.vout.mouseup(function(){j.voutdown=!1;j.zoomstruct.vout.css("border-style","outset");return!1}),j.zoomstruct.hin.mousedown(function(){j.hindown=!0;j.zoomstruct.hin.css("border-style","inset");k();return!1}),j.zoomstruct.hout.mousedown(function(){j.houtdown=
!0;j.zoomstruct.hout.css("border-style","inset");k();return!1}),j.zoomstruct.vin.mousedown(function(){j.vindown=!0;j.zoomstruct.vin.css("border-style","inset");k();return!1}),j.zoomstruct.vout.mousedown(function(){j.voutdown=!0;j.zoomstruct.vout.css("border-style","inset");k();return!1}));a.mousewheel(function(a,b){if(j.zoomOn==false)return true;P(j,1+Math.abs(b)*b*j.zoomFactor);return false});a.mouseup(function(){j.mouseDown=0});a.mousemove(function(a){if(j.mouseDown==1){if(a.pageX>j.lastX){var b=
a.pageX-j.lastX,p=j.chart.xAxis[0].getExtremes(),b=(p.max-p.min)*b/c;j.chart.xAxis[0].setExtremes(p.min-b,p.max-b)}else if(a.pageX<j.lastX){b=j.lastX-a.pageX;p=j.chart.xAxis[0].getExtremes();b=(p.max-p.min)*b/c;j.chart.xAxis[0].setExtremes(p.min+b,p.max+b)}if(a.pageY>j.lastY){b=1*(a.pageY-j.lastY);p=j.chart.yAxis[0].getExtremes();b=(p.max-p.min)*b/e;j.chart.yAxis[0].setExtremes(p.min+b,p.max+b)}else if(a.pageY<j.lastY){b=1*(j.lastY-a.pageY);p=j.chart.yAxis[0].getExtremes();b=(p.max-p.min)*b/e;j.chart.yAxis[0].setExtremes(p.min-
b,p.max-b)}}j.lastX=a.pageX;j.lastY=a.pageY;return false})}for(var m=a+"_LI",f=[],o=[],r={},n=[],F=b.length,i=0;i<b.length;i++)f.push(c[b[i]][a]),n.push(k[b[i]]),o=o.concat(c[b[i]][a].data);r=aa(o);"volmean"==a?S=r:"masked_volmean"==a&&(Z=r);if(a.match(/^(volmean|masked_volmean|mean_difference)$/))for(var v in f){for(var h=o=k=0,q=0,i=f[v].data,e=0;e<i.length;e++){var x=Math.abs((i[e][1]-r.mean)/r.stddev);4<x&&++o;3<x&&++k;"mean_difference"==a&&(x=100*(i[e][1]/S.mean),2<x&&++q,1<x&&++h)}if("volmean"==
a||"masked_volmean"==a)e="absz3_"+n[v],i="absz4_"+n[v],"masked_volmean"==a&&(e="mask_"+e,i="mask_"+i),$(".summary #overall_summary #"+e).html(k),$(".summary #overall_summary #"+i).html(o);"mean_difference"==a&&($(".summary #overall_summary #perc2_"+n[v]).html(q),$(".summary #overall_summary #perc1_"+n[v]).html(h))}$("#"+m+" *").remove();h='<table class="data" id="'+a+'_summary_table"><tbody>\n';for(e=0;4>e;e++){h+="<tr>\n";if(0==e){h+='<th colspan="2">'+a+"</th>";for(i=0;i<b.length;i++)h+="<th>"+
n[i]+"</th>"}else if(1==e)for(i=0;i<F+2;i++)h=0==i?h+'<td rowspan="2">mean:</td>':1==i?h+"<td>(absolute)</td>":h+("<td>"+f[i-2].summary.mean.toFixed(4)+"</td>");else if(2==e)for(i=0;i<F+2;i++)0!=i&&(h=1==i?h+"<td>(relative)</td>":h+("<td>"+(f[i-2].summary.mean/r.mean).toFixed(4)+"</td>"));h+="</tr>\n"}$("#"+m).append(h+"</tbody></table>");k=document.getElementById(m);v=document.createElement("table");k.appendChild(v);h=document.createElement("tr");v.appendChild(h);k=document.createElement("td");k.setAttribute("style",
"display: block");h.appendChild(k);o=document.createElement("div");o.setAttribute("style","display: block; position: relative; height: 300px; width: 600px;");k.appendChild(o);k=document.createElement("div");k.id=a+"_chart1";k.setAttribute("style","position: absolute; left: 0px; top: 0px; z-index: 0; height: 300px; width: 600px;");o.appendChild(k);o=d(o,a+"_zoomtext1");q=document.createElement("td");h.appendChild(q);q.id=a+"_hist";q.setAttribute("style","height: 300px; width: 300px;");h='<div class="hideButton">show data</div>'+
('<table class="data" id="'+a+'_data_table" style="display:none;"><tbody>\n')+"<tr><th>volnum</th>";for(i=0;i<b.length;i++)h+="<th>"+n[i]+"</th>";var h=h+"</tr>",x=null,s;for(s in f)f[s].summary.count>x&&(x=f[s].summary.count);for(e=0;e<parseInt(x);e++){h+="<tr><td>"+e+"</td>";for(i=0;i<F;i++)e<f[i].data.length?(s=Math.abs((f[i].summary.mean-f[i].data[e][1])/f[i].summary.stddev),h=5<=s?h+'<td class="hot">':4<=s?h+'<td class="med">':3<=s?h+'<td class="mild">':h+"<td>",h+=parseFloat(f[i].data[e][1]).toFixed(5)+
"</td>"):h+="<td></td>";h+="</tr>"}$("#"+m).append(h+"</tbody></table>");var m=N[a],f=[],x=[],w=m.demean?r.mean:0,u=1;m.meanscale&&(u=m.meanvolmean?u/S.mean:m.meanmaskedvolmean?u/Z.mean:u/r.mean,u*=m.plotpercent?100:1);F=[];s=[];for(var h=[],B=[],i=0;i<b.length;i++){var e=$.extend(!0,[],c[i][a].data.slice(0)),A=$.extend(!0,[],c[i][a].data.slice(0)),C=m.demean?c[i][a].summary.mean:0,G=1;m.meanscale&&(G=m.meanvolmean?G/c[i].volmean.summary.mean:m.meanmaskedvolmean?G/c[i].masked_volmean.summary.mean:
G/c[i][a].summary.mean,G*=m.plotpercent?100:1);for(var z=0;z<e.length;z++)e[z][1]=G*(e[z][1]-C),A[z][1]=u*(A[z][1]-w);F.push(C-w);B.push(c[i][a].summary.mean);s.push(c[i][a].summary.stddev);h.push(G);f.push(e);x.push(A)}b=[];for(e=0;e<x.length;e++)b=b.concat(x[e]);for(var E=W(b,r.mean-w,m.histozscore?r.stddev*u:1,m.historange,m.histozscore),D=[],e=0;e<x.length;e++){i=f[e];D.push([]);b=[];for(c=0;12>c;c++)b.push(0);b=h[e];c=s[e];D[e]=W(i,0,m.histozscore?c*b:1,m.historange,m.histozscore)}var H=new Highcharts.Chart({credits:{enabled:!1},
chart:{renderTo:q.id,type:"column",reflow:!1,width:300,style:{width:300,position:"relative"}},plotOptions:{column:{pointPadding:0,groupPadding:0}},series:[{id:"series-hist",name:"All data",data:E}],title:{text:null},xAxis:{tickInterval:1,labels:{formatter:function(){return this.value<-5||this.vlaue>5?"":this.value==-5?"<=-5":this.value==5?"5=>":this.value}},title:{text:"# of stddevs from mean"},min:-5,max:5}}),b={min:m.ymin,max:m.ymax,startOnTick:!1,endOnTick:!1,tickPixelInterval:36,title:{text:m.yaxistitle}},
L=function(a,b,c,p,e,k,j){for(var a=b.index,f=b.chart.series,i=b.chart.yAxis[0],h=false,d=0;d<f.length;d++)if(d!=a&&!f[d].visible){h=true;break}var M=!b.visible||!h;if(!b.visible||h)for(d=0;d<f.length;d++){if(f[d].visible)for(h=-5;h<=5;h++)i.removePlotLine("s"+d.toString()+"z"+h.toString())}else for(h=-5;h<=5;h++)i.removePlotLine("gz"+h.toString());j&&H.get("series-hist").remove(false);if(!M){for(d=0;d<f.length;d++)f[d].visible||f[d].show();j&&H.addSeries({id:"series-hist",name:"All data",data:E});
e!=null&&k!=null&&g(b.chart,i,"g",e,k);return false}for(d=0;d<f.length;d++)f[d].index==a?f[d].visible||f[d].show():f[d].visible&&f[d].hide();g(b.chart,i,"s"+a.toString(),c[a],p[a]);j&&H.addSeries({id:"series-hist",name:n[a],data:D[a]});return false},P=function(a,b,c){var p=a.chart.xAxis[0].getExtremes().min,e=a.chart.xAxis[0].getExtremes().max,b=(1-b)*(e-p)/2,f=a.chart.yAxis[0].getExtremes().min,k=a.chart.yAxis[0].getExtremes().max,c=(1-c)*(k-f)/2;a.chart.xAxis[0].setExtremes(p-b,e+b);a.chart.yAxis[0].setExtremes(f-
c,k+c)},I=r.mean,Q=r.stddev,R=B.slice(0),J=s.slice(0);m.demean&&(R=F.slice(0),I=0);if(m.meanscale){for(e=0;e<F.length;e++)R[e]*=h[e],J[e]*=h[e];Q*=u}c=function(a){return L(a,this,R,J,I,Q,true)};r=[];for(e=0;e<x.length;e++)r.push({data:x[e],name:n[e],marker:{enabled:!1},shadow:!1,events:{legendItemClick:c}});r=new Highcharts.Chart({credits:{enabled:!1},chart:{renderTo:k.id,type:"line",alignTicks:!1,marginRight:"30",reflow:!1,width:600,style:{width:600,position:"relative"}},series:r,tooltip:{enabled:!1},
title:{text:m.plottitle},subtitle:{text:m.meanscale?"baseline (plotted at 0) is mean across all series"+(m.meanvolmean?"' <i>volume means</i>":m.meanmaskedvolmean?"' <i>masked volume means</i>":""):""},yAxis:b});l($("#"+k.id),r,600,300,o);g(r,r.yAxis[0],"g",I,Q);if(m.demean){r=document.createElement("tr");v.appendChild(r);c=document.createElement("td");c.setAttribute("style","display: block; position: relative; height: 300px; width: 600px;");r.appendChild(c);v=document.createElement("div");v.setAttribute("style",
"display: block");c.appendChild(v);c=document.createElement("div");c.id=a+"_chart2";c.setAttribute("style","position: absolute; position: relative; left: 0px; top: 0px; z-index: 0; height: 300px; width: 600px;");v.appendChild(c);a=d(v,a+"_zoomtext2");v=document.createElement("td");r.appendChild(v);for(var O=F.slice(0),K=s.slice(0),e=0;e<F.length;e++)O[e]=0,K[e]*=h[e];v=function(a){return L(a,this,O,K,null,null,false)};r=[];for(e=0;e<f.length;e++)r.push({data:f[e],name:n[e],marker:{enabled:!1},shadow:!1,
events:{legendItemClick:v}});r=new Highcharts.Chart({credits:{enabled:!1},chart:{renderTo:c.id,type:"line",marginRight:"30",reflow:!1,width:600,style:{width:600,position:"relative"}},series:r,tooltip:{enabled:!1},title:{text:m.plottitle},subtitle:{text:m.meanscale?"each series' baseline is its mean, plotted at 0":""},yAxis:b});l($("#"+c.id),r,600,300,a)}}function z(a,b,c,k){var d={data:null,disp_minval:null,disp_maxval:null,act_minval:null,act_maxval:null};k&&(d.act_minval=s[b][k+"_min"],d.act_maxval=
s[b][k+"_max"]);$.ajax({type:"GET",url:w+a,beforeSend:function(a){a.overrideMimeType&&a.overrideMimeType("application/json")},async:!1,dataType:"json",success:function(b){d.data=H?w+(""+a).replace(/(.json)/gi,""):"data:image/gif;base64,"+b.data;d.disp_minval=b.minval;d.disp_maxval=b.maxval},error:function(b,c,d){$("#errors").append("failed loading: "+w+a+c.toString()+d.toString())}});return d}function I(a){if(H)alert("Update your browser to something modern, then we can do that");else{var b=[],c=
[];$("ul.means table.means span.disp_"+a+"_imgmin").each(function(){b.push(parseFloat($(this).text()))});$("ul.means table.means span.disp_"+a+"_imgmax").each(function(){c.push(parseFloat($(this).text()))});var d=Math.min.apply(null,b),g=Math.max.apply(null,c),l=g-d;$("ul.means table.means img."+a+"_img").each(function(){var b=parseFloat($(this).closest("tr").parent().find("span.disp_"+a+"_imgmin").text()),c=parseFloat($(this).closest("tr").parent().find("span.disp_"+a+"_imgmax").text())-b,f=255*
(b-d)/l,c=c/l,g=document.getElementById($(this).attr("id")),M=document.createElement("canvas"),o=M.getContext("2d"),n=g.width,i=g.height;M.width=n;M.height=i;o.drawImage(g,0,0);var n=o.getImageData(0,0,n,i),i=n.data,y=0.018*4.5,b=(b-d)/l;if(/(sfnr|mean)/.test(a))for(var h=0;h<i.length;h+=4)i[h]=f+i[h]*c,i[h+1]=f+i[h+1]*c,i[h+2]=f+i[h+2]*c;else for(h=0;h<i.length;h+=4){var f=i[h],q=i[h+1],e=i[h+2],f=f/255,q=q/255,e=e/255,f=(f<=y)*(f/4.5)+(f>y)*Math.pow((f+0.099)/1.099,1/0.45),q=(q<=y)*(q/4.5)+(q>y)*
Math.pow((q+0.099)/1.099,1/0.45),e=(e<=y)*(e/4.5)+(e>y)*Math.pow((e+0.099)/1.099,1/0.45),f=255*f,q=255*q,e=255*e,s=0,s=25.5>f?f/255:255>f?0.1+0.3*((f-25.5)/229.5):255>q?0.4+0.3*(q/255):0.7+0.3*(e/255),f=b+s*c;0.1>f?e=q=f*=255:0.4>f?(e=(f-0.1)/0.3,f=255*(0.1+0.9*e),q=255*(0.1-0.1*e),e=255*(0.1-0.1*e)):0.7>f?(e=(f-0.4)/0.3,f=255,q=255*e,e=0):(e=(f-0.7)/0.3,q=f=255,e*=255);f/=255;q/=255;e/=255;f=(0.018>=f)*4.5*f+(0.018<f)*(1.099*Math.pow(f,0.45)-0.099);q=(0.018>=q)*4.5*q+(0.018<q)*(1.099*Math.pow(q,
0.45)-0.099);e=(0.018>=e)*4.5*e+(0.018<e)*(1.099*Math.pow(e,0.45)-0.099);f*=255;q*=255;e*=255;i[h]=f;i[h+1]=q;i[h+2]=e}o.putImageData(n,0,0,0,0,n.width,n.height);g.src=M.toDataURL()});$("ul.means table.means span."+a+"_cbarmin").each(function(){$(this).text(d)});$("ul.means table.means span."+a+"_cbarmax").each(function(){$(this).text(g)});$("ul.means table.means span.disp_"+a+"_imgmin").each(function(){$(this).text(d)});$("ul.means table.means span.disp_"+a+"_imgmax").each(function(){$(this).text(g)})}return!0}
var H=!1;/MSIE (\d+\.\d+);/.test(navigator.userAgent)&&9>new Number(RegExp.$1)&&(H=!0);var J={};(function(){for(var a,b=/\+/g,c=/([^&=]+)=?([^&]*)/g,d=window.location.search.substring(1);a=c.exec(d);)J[decodeURIComponent(a[1].replace(b," "))]=decodeURIComponent(a[2].replace(b," "))})();for(var w=J.datapath?J.datapath+"/":"",l=[{name:"volmean",plottitle:"Volume means",description:"This metric tracks the mean intensity of each volume (time point) in the data.  Increases and decreases in overall  brain activity will be reflected in this plot.  RF spikes and other acquisition artifacts may be visible here (esp. if they affect an entire volume).",
demean:!0,meanscale:!0,meanvolmean:!0,meanmaskedvolmean:!1,plotpercent:!0,ymin:-3,ymax:3,yaxistitle:"Mean intensity (% from baseline)",histozscore:!0,historange:[-5,5]},{name:"masked_volmean",plottitle:"Masked, detrended volume means",description:"This is the <b><i>volume means</i></b> metric applied to masked and detrended data.</p> <p><b>Volume means:</b> this metric tracks the mean intensity of each volume (time point) in the data.  Increases and decreases in overall brain activity will be reflected in this plot.  RF spikes and other acquisition artifacts may be visible here (esp. if they affect an entire volume).",
demean:!0,meanscale:!0,meanvolmean:!1,meanmaskedvolmean:!0,plotpercent:!0,ymin:-3,ymax:3,yaxistitle:"Mean intensity (% from baseline)",histozscore:!0,historange:[-5,5]},{name:"mean_difference",plottitle:"Means of mean volume difference",description:"For each volume <i>vol</i> and a mean volume <i>meanvol</i>, this metric tracks the mean intensity of (<i>vol</i> - <i>meanvol</i>).  Slow drifts in the input data will be apparent in this plot.",demean:!0,meanscale:!0,meanvolmean:!0,meanmaskedvolmean:!1,
plotpercent:!0,ymin:-3,ymax:3,yaxistitle:"Mean of mean volume difference (% from baseline)",histozscore:!0,historange:[-5,5]},{name:"masked_tdiff_volmean",plottitle:"Masked, detrended running difference ('velocity')",description:"This metric tracks the change in the mean intensity of consecutive volumes by subtracting the mean intensity of each volume from the mean intensity of its subsequent volume.",demean:!0,meanscale:!0,meanvolmean:!1,meanmaskedvolmean:!0,plotpercent:!0,ymin:-3,ymax:3,yaxistitle:"Mean of running difference volume (% from baseline)",
histozscore:!0,historange:[-5,5]},{name:"cmassx",plottitle:"Center of mass (X direction)",description:"This metric is calculated as a weighted average of voxel intensities, where each voxel is weighted by its coordinate index in the X, Y, or Z direction.  Head motion in each of the three directions may be reflected as a change in this metric.",demean:!0,meanscale:!1,meanvolmean:!1,meanmaskedvolmean:!1,plotpercent:!1,ymin:-5,ymax:5,yaxistitle:"Displacement (in mm) from mean",histozscore:!0,historange:[-5,
5]},{name:"cmassy",plottitle:"Center of mass (Y direction)",description:"This metric is calculated as a weighted average of voxel intensities, where each voxel is weighted by its coordinate index in the X, Y, or Z direction.  Head motion in each of the three directions may be reflected as a change in this metric.",demean:!0,meanscale:!1,meanvolmean:!1,meanmaskedvolmean:!1,plotpercent:!1,ymin:-5,ymax:5,yaxistitle:"Displacement (in mm) from mean",histozscore:!0,historange:[-5,5]},{name:"cmassz",plottitle:"Center of mass (Z direction)",
description:"This metric is calculated as a weighted average of voxel intensities, where each voxel is weighted by its coordinate index in the X, Y, or Z direction.  Head motion in each of the three directions may be reflected as a change in this metric.",demean:!0,meanscale:!1,meanvolmean:!1,meanmaskedvolmean:!1,plotpercent:!1,ymin:-5,ymax:5,yaxistitle:"Displacement (in mm) from mean",histozscore:!0,historange:[-5,5]},{name:"masked_outlier_percent",plottitle:"Outlier voxel percentages",description:'This metric is calculated by running the detrended data through the <a href="http://afni.nimh.nih.gov/afni/">AFNI</a> program <tt>3dToutcount</tt>.  This metric shows the percentage of "outlier" voxels in each volume.  For a definition of "outlier", see the <a href="http://afni.nimh.nih.gov/pub/dist/doc/program_help/3dToutcount.html">documentation for <tt>3dToutcount</tt></a> on the AFNI web site, or run <tt>3dToutcount</tt> without arguments.',
demean:!1,meanscale:!1,meanvolmean:!1,meanmaskedvolmean:!1,plotpercent:!0,ymin:0,ymax:5,yaxistitle:"Percent of outlier voxels",histozscore:!0,historange:[-5,5]},{name:"masked_fwhmx",plottitle:"Full-width half-maximum (FWHM) (X direction)",description:'This metric shows the estimated FWHM for each volume in X, Y, or Z directions, used as a measure of the "smoothness" of the data.',demean:!1,meanscale:!1,meanvolmean:!1,meanmaskedvolmean:!1,plotpercent:!1,ymin:0,ymax:null,yaxistitle:null,histozscore:!0,
historange:[-5,5]},{name:"masked_fwhmy",plottitle:"Full-width half-maximum (FWHM) (Y direction)",description:'This metric shows the estimated FWHM for each volume in X, Y, or Z directions, used as a measure of the "smoothness" of the data.',demean:!1,meanscale:!1,meanvolmean:!1,meanmaskedvolmean:!1,plotpercent:!1,ymin:0,ymax:null,yaxistitle:null,histozscore:!0,historange:[-5,5]},{name:"masked_fwhmz",plottitle:"Full-width half-maximum (FWHM) (Z direction)",description:'This metric shows the estimated FWHM for each volume in X, Y, or Z directions, used as a measure of the "smoothness" of the data.',
demean:!1,meanscale:!1,meanvolmean:!1,meanmaskedvolmean:!1,plotpercent:!1,ymin:0,ymax:null,yaxistitle:null,histozscore:!0,historange:[-5,5]},{name:"spectrummean",plottitle:"Frequency spectrum (mean over mask)",description:"A frequency spectrum is calculated for each voxel in the mask and this plot shows the mean power for each frequency across all voxels.",demean:!1,meanscale:!1,meanvolmean:!1,meanmaskedvolmean:!1,plotpercent:!1,ymin:0,ymax:null,yaxistitle:null,histozscore:!0,historange:[-5,5]},{name:"spectrummax",
plottitle:"Frequency spectrum (max over mask)",description:"A frequency spectrum is calculated for each voxel in the mask and this plot shows the maximum power for each frequency across all voxels.",demean:!1,meanscale:!1,meanvolmean:!1,meanmaskedvolmean:!1,plotpercent:!1,ymin:0,ymax:null,yaxistitle:null,histozscore:!0,historange:[-5,5]}],A=[],a=0;a<l.length;a++)A.push(l[a].name);for(var N={},a=0;a<l.length;a++)N[l[a].name]=l[a];var O=[],g;for(g in thisarr="mean_middle_slice,mean_sfnr_middle_slice,mean_snr_middle_slice,mean_masked_fwhmx,mean_masked_fwhmy,mean_masked_fwhmz,count_volmean_indiv_masked_z3,count_volmean_indiv_masked_z4,count_velocity_indiv_masked_1percent,count_velocity_indiv_masked_2percent,count_volmean_indiv_z3,count_volmean_indiv_z4,count_outliers_1percent,count_outliers_2percent,count_potentially_clipped".split(","))O[thisarr[g]]=
[];var K=[];for(g in thisarr=["slicevar_data","slicevar_cbar","slicevar_max","slicevar_min","slicevar_cbar_json"])K[thisarr[g]]=[];var T=[];for(g in thisarr="mean_cbar_json,mean_data_json,sfnr_cbar_json,sfnr_data_json,stddev_cbar_json,stddev_data_json,mask_data,stddev_max,stddev_min,mean_max,mean_min,sfnr_min,sfnr_max".split(","))T[thisarr[g]]=[];var C=[],u=[],s=[],D=[],n=[],o=[],S=null,Z=null,L=null;$.ajax({type:"GET",url:w+"reportLabel.txt",beforeSend:function(a){a.overrideMimeType&&a.overrideMimeType("text/plain")},
async:!1,dataType:"text",success:function(a){L=a.toString().replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}});null!=L&&($("#reportlabel").html(L),$("#title").html(L));$.ajax({type:"GET",url:w+"labelList.txt",beforeSend:function(a){a.overrideMimeType&&a.overrideMimeType("text/plain")},async:!1,dataType:"text",success:function(a){a=a.toString().split("\n");$.each(a,function(a,b){if(b){short_name=b;var c=o.length;o.push(short_name);C[c]||(C[c]=[]);n[c]||(n[c]=[]);u[c]||(u[c]=[]);s[c]||
(s[c]=[]);for(g in N)C[c][g]||(C[c][g]=[]);for(g in O)n[c][g]||(n[c][g]=[]);for(g in K)u[c][g]||(u[c][g]=[]);for(g in T)!s[c][g]&&!g.match(/(cbar)/)&&(s[c][g]=[])}})},error:function(a,b,c){$("#errors").append("failed loading: "+w+"labelList.txt"+b.toString()+c.toString())}});for(var d=0;d<o.length;d++){g=o[d];var a={},c;for(c in N)nameobj={name:c},a["json/qa_arraystats_"+c+"_"+g+".json"]=$.proxy(function(a){var b=0;statsdata=a.data;for(b=0;b<statsdata.length;b++){statsdata[b][0]=parseFloat(statsdata[b][0]);
statsdata[b][1]=parseFloat(statsdata[b][1])}b=a.summary;b.count=parseFloat(b.count);b.mean=parseFloat(b.mean);b.stddev=parseFloat(b.stddev);C[d][this.name]=a},nameobj);a["json/qa_scalarstats_"+g+".json"]=function(a){for(var b in O){stat=a[b];if(!isNaN(parseFloat(stat))&&isFinite(stat)){stat=parseFloat(stat);n[d][b]=stat}}};a["json/qa_imagerefs_"+g+".json"]=function(a){for(var b in K){stat=a[b];!isNaN(parseFloat(stat))&&isFinite(stat)&&(stat=parseFloat(stat));u[d][b]=stat}for(b in T){stat=a[b];!isNaN(parseFloat(stat))&&
isFinite(stat)?stat=parseFloat(stat):stat.match(/\//)&&(stat=void 0);s[d][b]=stat;if(/(cbar)/.test(b)){D[b]=[];D[b].push(stat)}}};for(var U in a)$.ajax({type:"GET",url:w+U,beforeSend:function(a){a.overrideMimeType&&a.overrideMimeType("application/json")},async:!1,dataType:"json",success:a[U],error:function(a,b,c){$("#errors").append("failed loading: "+w+U+b.toString()+c.toString())}})}for(var E=[],d=0;d<o.length;d++)E.push(d);c='<li><table class="data" id="overall_summary"><tbody>\n';l=E.length;for(a=
0;23>a;a++){c+="<tr>\n";if(0==a){c+='<th colspan="3"></th>';for(d=0;d<E.length;d++)c+="<th>"+o[d]+"</th>"}else if(1==a)for(var b=0;b<l+3;b++)if(0==b)c+="<td>input</td>";else if(1==b)c+='<td colspan="2"># potentially-clipped voxels</td>';else{if(2!=b){var B=n[b-3].count_potentially_clipped;c=0!=B?c+'<td class="med">':c+"<td>";c+=B+"</td>"}}else if(2==a)for(b=0;b<l+3;b++)c=0==b?c+'<td rowspan="6">input</td>':1==b?c+'<td rowspan="2"># vols. with mean intensity abs. z-score > 3</td>':2==b?c+"<td>individual</td>":
c+("<td>"+n[b-3].count_volmean_indiv_z3+"</td>");else if(3==a)for(b=0;b<l+3;b++)2>b||(c=2==b?c+"<td>rel. to grand mean</td>":c+('<td id="absz3_'+o[b-3]+'"></td>'));else if(4==a)for(b=0;b<l+3;b++)1>b||(c=1==b?c+'<td rowspan="2"># vols. with mean intensity abs. z-score > 4</td>':2==b?c+"<td>individual</td>":c+("<td>"+n[b-3].count_volmean_indiv_z4+"</td>"));else if(5==a)for(b=0;b<l+3;b++)2>b||(c=2==b?c+"<td>rel. to grand mean</td>":c+('<td id="absz4_'+o[b-3]+'"></td>'));else if(6==a)for(b=0;b<l+3;b++)1>
b||(1==b?c+='<td colspan="2"># vols. with mean volume difference > 1%</td>':2!=b&&(c+='<td id="perc1_'+o[b-3]+'"></td>'));else if(7==a)for(b=0;b<l+3;b++)1>b||(1==b?c+='<td colspan="2"># vols. with mean volume difference > 2%</td>':2!=b&&(c+='<td id="perc2_'+o[b-3]+'"></td>'));else if(8==a)for(b=0;b<l+3;b++)c=0==b?c+'<td rowspan="3">masked</td>':1==b?c+'<td rowspan="3">mean FWHM</td>':2==b?c+"<td>X</td>":c+("<td>"+n[b-3].mean_masked_fwhmx+" </td>");else if(9==a)for(b=0;b<l+3;b++)2>b||(c=2==b?c+"<td>Y</td>":
c+("<td>"+n[b-3].mean_masked_fwhmy+" </td>"));else if(10==a)for(b=0;b<l+3;b++)2>b||(c=2==b?c+"<td>Z</td>":c+("<td>"+n[b-3].mean_masked_fwhmz+" </td>"));else if(11==a)for(b=0;b<l+3;b++)c=0==b?c+'<td rowspan="11">masked, detrended</td>':1==b?c+'<td rowspan="2"># vols. with mean intensity abs. z-score > 3</td>':2==b?c+"<td>individual</td>":c+("<td>"+n[b-3].count_volmean_indiv_masked_z3+"</td>");else if(12==a)for(b=0;b<l+3;b++)2>b||(c=2==b?c+"<td>rel. to grand mean</td>":c+('<td id="mask_absz3_'+o[b-
3]+'"></td>'));else if(13==a)for(b=0;b<l+3;b++)1>b||(c=1==b?c+'<td rowspan="2"># vols. with mean intensity abs. z-score > 4</td>':2==b?c+"<td>individual</td>":c+("<td>"+n[b-3].count_volmean_indiv_masked_z4+"</td>"));else if(14==a)for(b=0;b<l+3;b++)2>b||(c=2==b?c+"<td>rel. to grand mean</td>":c+('<td id="mask_absz4_'+o[b-3]+'"></td>'));else if(15==a)for(b=0;b<l+3;b++)1>b||(1==b?c+='<td colspan="2"># vols. with running difference > 1%</td>':2!=b&&(c+="<td>"+n[b-3].count_velocity_indiv_masked_1percent+
"</td>"));else if(16==a)for(b=0;b<l+3;b++)1>b||(1==b?c+='<td colspan="2"># vols. with running difference > 2%</td>':2!=b&&(c+="<td>"+n[b-3].count_velocity_indiv_masked_2percent+"</td>"));else if(17==a)for(b=0;b<l+3;b++)1>b||(1==b?c+='<td colspan="2"># vols. with > 1% outlier voxels</td>':2!=b&&(c+="<td>"+n[b-3].count_outliers_1percent+"</td>"));else if(18==a)for(b=0;b<l+3;b++)1>b||(1==b?c+='<td colspan="2"># vols. with > 2% outlier voxels</td>':2!=b&&(c+="<td>"+n[b-3].count_outliers_2percent+"</td>"));
else if(19==a)for(b=0;b<l+3;b++)1>b||(1==b?c+='<td colspan="2">mean (ROI in middle slice)</td>':2!=b&&(c+="<td>"+n[b-3].mean_middle_slice+"</td>"));else if(20==a)for(b=0;b<l+3;b++)1>b||(1==b?c+='<td colspan="2">mean SNR (ROI in middle slice)</td>':2!=b&&(c+="<td>"+n[b-3].mean_snr_middle_slice+"</td>"));else if(21==a)for(b=0;b<l+3;b++)1>b||(1==b?c+='<td colspan="2">mean SFNR (ROI in middle slice)</td>':2!=b&&(c+="<td>"+n[b-3].mean_sfnr_middle_slice+"</td>"));else if(22==a)for(b=0;b<l+3;b++)0==b?c+=
"<td>runs to include in plots: ":1!=b&&(c=2==b?c+'<td colspan="2" style="text-align:center;"><div id="reload" class="button">reload</div></td>':c+('<td style="text-align:center;"><input name="inc_runs[]" type="checkbox" checked="checked" value="'+(b-3).toString()+'"></input></td>'));c+="</tr>\n"}$(".summary").append(c+"</tbody></table></li>");c=n=null;for(a=0;a<A.length;a++){g=A[a];c=!1;for(d=0;d<o.length;d++)if(0==C[d][g].length){c=!0;break}c||X(g,E,C,o)}for(d=0;d<u.length;d++)g=o[d],a=z(u[d].slicevar_cbar_json,
d,g,null),c='<li id="slicevar_'+g+'">'+g+"<br>",c+='<table class="data" style="width:384px;"><tbody>',c+='<tr><td style="text-align:left;">0</td>',c+='<td style="text-align:right;">30</td></tr>',c+='<tr><td colspan="2"><img src="'+a.data+'"></img></td></tr>',c+="<tr><td>image min:"+u[d].slicevar_min+"</td>",c+="<td>image max:"+u[d].slicevar_max+"</td></tr>",c+="</tbody></table>",c+='<img src="'+w+u[d].slicevar_data+'"></img></li>',$("ul.slicevar").append(c),$("#slicevar_runs").append("<li>"+g+"</li>");
for(d=0;d<s.length;d++)g=o[d],$("ul.means").append('<li id="means_'+g+'">'+g+":<br></li>"),c=z(D.mean_cbar_json,d,g,null),l=z(D.stddev_cbar_json,d,g,null),b=z(s[d].mean_data_json,d,g,"mean"),B=z(s[d].stddev_data_json,d,g,"stddev"),a='<table class="means"><tbody>',a+="<tr>",a+='<th colspan="2">mean</td>',a+='<td style="width:20px;"></td>',a+='<th colspan="2">standard deviation</td>',a+="</tr>",a+="<tr>",a+='<td><span class="mean_cbarmin">'+b.disp_minval+"</span></td>",a+='<td style="text-align: right;"><span class="mean_cbarmax">'+
b.disp_maxval+"</span></td>",a+="<td></td>",a+='<td><span class="stddev_cbarmin">'+B.disp_minval+"</span></td>",a+='<td style="text-align: right;"><span class="stddev_cbarmax">'+B.disp_maxval+"</span></td>",a+="<td></td>",a+="</tr>",a+="<tr>",a+='<td class="cbar" colspan="2"><img class="scalable" src="'+c.data+'"></td>',a+="<td></td>",a+='<td class="cbar" colspan="2"><img class="scalable" src="'+l.data+'"></td>',a+="</tr>",a+='<tr style="display:none;">',a+='<td>image min: <span class="disp_mean_imgmin">'+
b.disp_minval+"</span></td>",a+='<td style="text-align: right;">image max: <span class="disp_mean_imgmax">'+b.disp_maxval+"</span></td>",a+="<td></td>",a+='<td>image min: <span class="disp_stddev_imgmin">'+B.disp_minval+"</span></td>",a+='<td style="text-align: right;">image max: <span class="disp_stddev_imgmax">'+B.disp_maxval+"</span></td>",a+="</tr>",a+="<tr>",a+='<td>image min: <span class="mean_imgmin">'+b.act_minval+"</span></td>",a+='<td style="text-align: right;">image max: <span class="mean_imgmax">'+
b.act_maxval+"</span></td>",a+="<td></td>",a+='<td>image min: <span class="stddev_imgmin">'+B.act_minval+"</span></td>",a+='<td style="text-align: right;">image max: <span class="stddev_imgmax">'+B.act_maxval+"</span></td>",a+="</tr>",a+="<tr>",a+='<td colspan="2"><img id="mean_'+g+'" class="scalable mean_img" src="'+b.data+'"></td>',a+="<td></td>",a+='<td colspan="2"><img id="stddev_'+g+'" class="scalable stddev_img" src="'+B.data+'"></td>',a+="</tr>",a+="<tr>",a+="</tr>",a+="<tr>",a+='<th colspan="2">sfnr (detrended)</th>',
a+="<td></td>",a+='<th colspan="2">mask</th>',a+="</tr>",a+="<tr>",c=z(D.sfnr_cbar_json,d,g,null),l=z(s[d].sfnr_data_json,d,g,"sfnr"),a+='<td><span class="sfnr_cbarmin">'+l.disp_minval+"</span></td>",a+='<td style="text-align: right;"><span class="sfnr_cbarmax">'+l.disp_maxval+"</span></td>",a+='<td colspan="4"></td>',a+="</tr>",a+="<tr>",a+='<td class="cbar" colspan="2"><img class="scalable" src="'+c.data+'"></td>',a+='<td colspan="4"></td>',a+="</tr>",a+='<tr style="display:none;">',a+='<td>image min: <span class="disp_sfnr_imgmin">'+
l.disp_minval+"</span></td>",a+='<td style="text-align: right;">image max: <span class="disp_sfnr_imgmax">'+l.disp_maxval+"</span></td>",a+='<td colspan="3"></td>',a+="</tr>",a+="<tr>",a+='<td>image min: <span class="sfnr_imgmin">'+l.act_minval+"</span></td>",a+='<td style="text-align: right;">image max: <span class="sfnr_imgmax">'+l.act_maxval+"</span></td>",a+='<td colspan="3"></td>',a+="</tr>",a+="<tr>",a+='<td colspan="2"><img id="sfnr_'+g+'" class="scalable sfnr_img" src="'+l.data+'"></td>',
a+="<td></td>",a+='<td colspan="2"><img src="'+w+s[d].mask_data+'"></td>',a+="</tr>",a+="</tbody></table>",$("ul.means li:last").append(a),$("#navigation #means_home #means_runs").append("<li>"+g+"</li>");$(window).load(function(){if(!H&&$("ul.means li").size()==o.length){do $("#errors").append('<div style="display:none;">scaled means</div>');while(!I("mean"));do $("#errors").append('<div style="display:none;">scaled sfnr</div>');while(!I("sfnr"));do $("#errors").append('<div style="display:none;">scaled stddev</div>');
while(!I("stddev"))}for(var a=0;a<A.length;a++){var b=A[a],c=true;$("#navigation #qaItems_home #indiv_stats li").each(function(){$(this).text()==b&&(c=false)});c&&$("#navigation #qaItems_home #indiv_stats").append("<li>"+b+"</li>")}C=D=s=u=null});$("ul.qaItems").on("click","div.hideButton",function(){$(this).next().fadeToggle("fast");$(this).text()=="show data"?$(this).text("hide data"):$(this).text()=="hide data"&&$(this).text("show data")});$("body").on("click","input",function(){if(/\w_(LI)$/.test($(this).parent().next("li").attr("id")))$(this).parent().next("li").toggle("fast");
else if($(this).parent().is("td")){var a=$(this).val();$("#"+a).toggle("fast")}else $(this).nextUntil("hr","ul").toggle("fast")});$("#navigation").on("click","li",function(a){var b;if(/\w+\_(home)/.test($(this).attr("id"))){b=$(this).attr("id");b=b.replace(/(\_home)/gi,"");b="."+b}else if(/(means|slicevar)/.test($(this).parent().attr("id"))){b=$(this).parent().attr("id");b="#"+b.replace(/(runs)/gi,$(this).text())}else{b=$(this).text();if($("#"+b+"_LI").length==0){var c=V(b,E,o);X(b,E,c,o)}b="#"+b+
"_LI"}$("html, body").animate({scrollTop:$(b).offset().top},1);a.preventDefault();a.stopPropagation()});$(document).on("click",".help",function(){if($(this).parents("ul").attr("class")=="qaItems"){var a=$(this).prev().text(),a=a.replace(/(\:|\s+)/gi,"");$(this).next(".description").html("<b>"+N[a].plottitle+"</b>: "+N[a].description+'<div class="close">close</div>').toggle()}else $(this).next(".description").toggle()});$(document).on("click",".close",function(){$(this).parent(".description").hide()});
$("#testButton").click(function(){var a=document.getElementById("volmean").__object__,b=a.Get("chart.key"),c=[],d=[],g;for(g in a.data)if(g>2){c.push(a.data[g]);d.push(b[g])}a.data=c;a.Set("chart.key",d);a.Draw()});$("div.description div.close").on("click",function(){$(this).parent().toggle()});$(".summary #overall_summary td #reload").on("click",function(){var a=[];$("input[name='inc_runs\\[\\]']:checked").each(function(){a.push(parseInt($(this).val()))});for(var b=[],c=[],d=[],g=0;g<a.length;g++){b.push([]);
d.push(g);c.push(o[a[g]])}for(var l=0;l<A.length;l++){for(var n=A[l],m=V(n,a,o),f=false,g=0;g<a.length;g++)if(m[a[g]][n].length==0){f=true;break}if(!f)for(g=0;g<a.length;g++)b[g][n]=m[a[g]][n]}for(l=0;l<A.length;l++){var n=A[l];Y(n,d,b,c)}E=a;return true})});
